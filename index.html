<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Rate Limit Explorer ¬∑ With Simulation Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:opsz@14..32&display=swap');
        * { font-family: 'Inter', sans-serif; }
        body { background: #1a1c1e; }
        
        .quota-alert {
            background: linear-gradient(145deg, #2d1f1f, #1f1a1a);
            border-left: 4px solid #f87171;
        }
        
        .rate-limit-card {
            background: #25282c;
            border: 1px solid #3d4147;
            transition: all 0.2s;
        }
        
        .rate-limit-card:hover {
            border-color: #8ab4f8;
            transform: translateY(-2px);
        }
        
        .simulation-mode {
            background: #1e3a2e;
            border: 1px solid #2a6e4b;
        }
        
        .retry-countdown {
            font-family: monospace;
            color: #fbbf24;
        }
    </style>
</head>
<body class="text-gray-200 p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header with mode toggle -->
        <div class="bg-[#25282c] rounded-xl p-4 mb-6 flex flex-col md:flex-row gap-4 items-start md:items-center justify-between border border-[#3d4147]">
            <div>
                <h1 class="text-xl font-semibold flex items-center gap-2">
                    <span class="text-2xl">üìä</span> Gemini Rate Limit Explorer
                </h1>
                <p class="text-sm text-gray-400 mt-1">Based on your actual quota data + simulation mode for testing</p>
            </div>
            <div class="flex flex-wrap gap-3">
                <div class="flex items-center gap-2 bg-[#1e2124] px-3 py-1.5 rounded-lg border border-[#3d4147]">
                    <span class="text-xs text-gray-400">üîë</span>
                    <input type="password" id="apiKey" placeholder="API key (optional in sim mode)" class="bg-transparent border-none text-sm w-48 focus:outline-none">
                </div>
                <button id="saveKeyBtn" class="bg-[#32363b] hover:bg-[#3d4147] px-4 py-2 rounded-lg text-sm border border-[#4a4f55]">Save Key</button>
                <button id="toggleSimMode" class="bg-[#1e3a2e] text-[#4ade80] px-4 py-2 rounded-lg text-sm border border-[#2a6e4b] flex items-center gap-2">
                    <span>üîÑ</span> Simulation ON
                </button>
            </div>
        </div>

        <!-- Quota warning (shown when 429 occurs) -->
        <div id="quotaWarning" class="quota-alert mb-6 p-4 rounded-lg hidden">
            <div class="flex items-start gap-3">
                <span class="text-2xl">‚ö†Ô∏è</span>
                <div>
                    <h3 class="font-semibold text-red-400">Free Tier Quota Exceeded</h3>
                    <p id="quotaMessage" class="text-sm text-gray-300 mt-1"></p>
                    <div id="retryTimer" class="text-sm font-mono mt-2 text-yellow-400"></div>
                    <div class="mt-3 flex gap-3">
                        <button id="enableSimBtn" class="bg-[#1e3a2e] text-[#4ade80] px-3 py-1.5 rounded text-sm border border-[#2a6e4b]">üîÑ Enable Simulation Mode</button>
                        <a href="https://ai.google.dev/gemini-api/docs/rate-limits" target="_blank" class="text-blue-400 text-sm underline underline-offset-2 px-3 py-1.5">View Rate Limits ‚Üí</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rate limits quick reference (from your data) -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-6">
            <div class="rate-limit-card p-3 rounded-lg">
                <div class="text-xs text-gray-400">Gemini 2.5 Flash</div>
                <div class="text-lg font-semibold">10 RPM</div>
                <div class="text-sm">250K TPM ¬∑ 20 RPD</div>
            </div>
            <div class="rate-limit-card p-3 rounded-lg">
                <div class="text-xs text-gray-400">Gemini 2.0 Pro</div>
                <div class="text-lg font-semibold">15 RPM</div>
                <div class="text-sm">Unlimited TPM ¬∑ 1.5K RPD</div>
            </div>
            <div class="rate-limit-card p-3 rounded-lg">
                <div class="text-xs text-gray-400">Gemma 3 27B</div>
                <div class="text-lg font-semibold">30 RPM</div>
                <div class="text-sm">15K TPM ¬∑ 14.4K RPD</div>
            </div>
            <div class="rate-limit-card p-3 rounded-lg">
                <div class="text-xs text-gray-400">Imagen 3</div>
                <div class="text-lg font-semibold">25 RPD</div>
                <div class="text-sm">Image generation only</div>
            </div>
        </div>

        <!-- Main interface -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left: Model selector & controls -->
            <div class="lg:col-span-1">
                <div class="bg-[#25282c] rounded-xl p-4 border border-[#3d4147]">
                    <h3 class="font-medium mb-3">üéØ Model Selection</h3>
                    
                    <select id="modelSelect" class="w-full bg-[#1e2124] border border-[#3d4147] rounded-lg px-4 py-3 text-sm mb-4">
                        <optgroup label="üìù Text-out (long context)">
                            <option value="gemini-2.5-flash-preview-04-17" data-rpm="10" data-tpm="250000" data-rpd="20">Gemini 2.5 Flash (10 RPM, 250K TPM, 20 RPD)</option>
                            <option value="gemini-2.0-flash-exp" data-rpm="15" data-tpm="-1" data-rpd="1500" selected>Gemini 2.0 Flash Exp (15 RPM, Unlimited TPM)</option>
                            <option value="gemini-2.0-pro-exp-02-05" data-rpm="15" data-tpm="-1" data-rpd="1500">Gemini 2.0 Pro Exp (15 RPM, Unlimited TPM)</option>
                        </optgroup>
                        <optgroup label="üñºÔ∏è Vision & Image">
                            <option value="gemini-2.0-flash-vision" data-rpm="15" data-tpm="-1" data-rpd="1500">Gemini 2.0 Flash Vision</option>
                            <option value="gemini-2.0-flash-exp-image-generation" data-rpm="15" data-tpm="-1" data-rpd="1500">Gemini 2.0 Flash Image Gen</option>
                            <option value="imagen-3.0-generate-001" data-rpm="0" data-tpm="0" data-rpd="25">Imagen 3 (25 images/day)</option>
                        </optgroup>
                        <optgroup label="üé§ Audio & Embedding">
                            <option value="gemini-2.0-flash-exp-audio" data-rpm="15" data-tpm="1000000" data-rpd="-1">Gemini 2.0 Flash Audio (1M TPM)</option>
                            <option value="text-embedding-004" data-rpm="100" data-tpm="30000" data-rpd="1000">Embedding 004 (100 RPM, 30K TPM)</option>
                        </optgroup>
                        <optgroup label="‚ö° High RPM (Gemma)">
                            <option value="gemma-3-27b-it" data-rpm="30" data-tpm="15000" data-rpd="14400">Gemma 3 27B (30 RPM, 15K TPM)</option>
                            <option value="gemma-3-12b-it" data-rpm="30" data-tpm="15000" data-rpd="14400">Gemma 3 12B</option>
                        </optgroup>
                    </select>

                    <!-- Current limits display -->
                    <div class="bg-[#1e2124] p-3 rounded-lg mb-4">
                        <div class="text-xs text-gray-400 mb-2">üìä Current model limits</div>
                        <div class="grid grid-cols-3 gap-2 text-center">
                            <div class="bg-[#2c2f33] p-2 rounded">
                                <div class="text-lg font-bold" id="displayRpm">15</div>
                                <div class="text-xs">RPM</div>
                            </div>
                            <div class="bg-[#2c2f33] p-2 rounded">
                                <div class="text-lg font-bold" id="displayTpm">‚àû</div>
                                <div class="text-xs">TPM</div>
                            </div>
                            <div class="bg-[#2c2f33] p-2 rounded">
                                <div class="text-lg font-bold" id="displayRpd">1.5K</div>
                                <div class="text-xs">RPD</div>
                            </div>
                        </div>
                    </div>

                    <!-- Usage tracker -->
                    <div class="mb-4">
                        <div class="flex justify-between text-xs mb-1">
                            <span>Session usage (simulated)</span>
                            <span id="requestCounter">0 / 60 RPM</span>
                        </div>
                        <div class="h-2 bg-[#1e2124] rounded-full overflow-hidden">
                            <div id="usageBar" class="h-full bg-[#8ab4f8] w-0"></div>
                        </div>
                    </div>

                    <!-- Input options -->
                    <textarea id="promptInput" rows="3" placeholder="Enter your prompt..." class="w-full bg-[#1e2124] border border-[#3d4147] rounded-lg px-4 py-3 text-sm mb-3">Explain which Gemini model is best for large-scale usage based on rate limits.</textarea>
                    
                    <div class="space-y-2 mb-4">
                        <label class="flex items-center gap-2 text-sm">
                            <input type="file" id="imageUpload" accept="image/*" class="text-xs">
                        </label>
                        <label class="flex items-center gap-2 text-sm">
                            <input type="checkbox" id="simulateMode" checked class="accent-[#4ade80]"> 
                            <span>üîÑ Simulation mode (no API calls)</span>
                        </label>
                    </div>

                    <button id="sendRequestBtn" class="w-full bg-[#8ab4f8] hover:bg-[#9bc2ff] text-black font-medium px-4 py-3 rounded-lg flex items-center justify-center gap-2">
                        <span>üöÄ</span> Execute Request
                    </button>
                </div>
            </div>

            <!-- Right: Response area with quota info -->
            <div class="lg:col-span-2">
                <div class="bg-[#1e2124] rounded-xl border border-[#3d4147] h-full flex flex-col">
                    <div class="flex items-center justify-between px-4 py-3 border-b border-[#32363b]">
                        <span class="text-sm font-medium">Response & Rate Limit Analysis</span>
                        <div class="flex gap-2">
                            <span id="modeIndicator" class="text-xs bg-[#1e3a2e] text-[#4ade80] px-2 py-1 rounded">SIMULATION ACTIVE</span>
                            <button id="clearBtn" class="text-xs bg-[#32363b] px-2 py-1 rounded hover:bg-[#3d4147]">Clear</button>
                        </div>
                    </div>
                    
                    <div id="responseContainer" class="p-4 flex-grow overflow-y-auto max-h-[500px] response-area">
                        <div class="text-gray-400 text-sm italic">‚ú® Welcome! You're in simulation mode. The free tier quota (429 errors) will be simulated so you can see how to handle them.</div>
                    </div>

                    <!-- Rate limit analysis panel -->
                    <div class="border-t border-[#32363b] p-4 bg-[#1a1c1e]">
                        <div class="text-xs text-gray-400 mb-2">üìà Large-scale usage recommendation (based on your data)</div>
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div class="bg-[#25282c] p-2 rounded">
                                <span class="text-[#8ab4f8]">Gemini 2.0 Pro/Flash</span>
                                <p class="text-xs text-gray-400">Best for long text (unlimited TPM)</p>
                            </div>
                            <div class="bg-[#25282c] p-2 rounded">
                                <span class="text-[#8ab4f8]">Gemma 3 27B</span>
                                <p class="text-xs text-gray-400">Best for high request volume (30 RPM)</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // State
            let apiKey = localStorage.getItem('gemini_api_key') || '';
            let simulationMode = true; // Start in simulation mode to avoid quota
            let requestCount = 0;
            let lastRequestTime = Date.now();
            let quotaResetTimer = null;

            // DOM elements
            const apiKeyInput = document.getElementById('apiKey');
            const saveKeyBtn = document.getElementById('saveKeyBtn');
            const toggleSimBtn = document.getElementById('toggleSimMode');
            const modelSelect = document.getElementById('modelSelect');
            const promptInput = document.getElementById('promptInput');
            const imageUpload = document.getElementById('imageUpload');
            const simulateCheck = document.getElementById('simulateMode');
            const sendBtn = document.getElementById('sendRequestBtn');
            const clearBtn = document.getElementById('clearBtn');
            const responseDiv = document.getElementById('responseContainer');
            const quotaWarning = document.getElementById('quotaWarning');
            const quotaMessage = document.getElementById('quotaMessage');
            const retryTimer = document.getElementById('retryTimer');
            const enableSimBtn = document.getElementById('enableSimBtn');
            const modeIndicator = document.getElementById('modeIndicator');
            const displayRpm = document.getElementById('displayRpm');
            const displayTpm = document.getElementById('displayTpm');
            const displayRpd = document.getElementById('displayRpd');
            const requestCounter = document.getElementById('requestCounter');
            const usageBar = document.getElementById('usageBar');

            // Set initial API key if exists
            if (apiKey) {
                apiKeyInput.value = apiKey;
            }

            // Update limits display when model changes
            modelSelect.addEventListener('change', () => {
                const selected = modelSelect.selectedOptions[0];
                const rpm = selected.dataset.rpm || '15';
                const tpm = selected.dataset.tpm === '-1' ? '‚àû' : (parseInt(selected.dataset.tpm)/1000 + 'K');
                const rpd = selected.dataset.rpd === '-1' ? '‚àû' : (parseInt(selected.dataset.rpd)/1000 + 'K');
                
                displayRpm.textContent = rpm;
                displayTpm.textContent = tpm;
                displayRpd.textContent = rpd;
            });

            // Save API key
            saveKeyBtn.addEventListener('click', () => {
                const key = apiKeyInput.value.trim();
                if (key) {
                    localStorage.setItem('gemini_api_key', key);
                    apiKey = key;
                    appendResponse('‚úÖ API key saved', false);
                }
            });

            // Toggle simulation mode
            toggleSimBtn.addEventListener('click', () => {
                simulationMode = !simulationMode;
                simulateCheck.checked = simulationMode;
                updateModeDisplay();
            });

            simulateCheck.addEventListener('change', (e) => {
                simulationMode = e.target.checked;
                updateModeDisplay();
            });

            function updateModeDisplay() {
                if (simulationMode) {
                    modeIndicator.textContent = 'SIMULATION ACTIVE';
                    modeIndicator.className = 'text-xs bg-[#1e3a2e] text-[#4ade80] px-2 py-1 rounded';
                    toggleSimBtn.innerHTML = '<span>üîÑ</span> Simulation ON';
                    toggleSimBtn.className = 'bg-[#1e3a2e] text-[#4ade80] px-4 py-2 rounded-lg text-sm border border-[#2a6e4b] flex items-center gap-2';
                } else {
                    modeIndicator.textContent = 'LIVE MODE';
                    modeIndicator.className = 'text-xs bg-[#32363b] text-[#fbbf24] px-2 py-1 rounded';
                    toggleSimBtn.innerHTML = '<span>üî¥</span> Live Mode';
                    toggleSimBtn.className = 'bg-[#32363b] text-[#fbbf24] px-4 py-2 rounded-lg text-sm border border-[#fbbf24] flex items-center gap-2';
                }
            }

            // Enable simulation from quota warning
            enableSimBtn.addEventListener('click', () => {
                simulationMode = true;
                simulateCheck.checked = true;
                updateModeDisplay();
                quotaWarning.classList.add('hidden');
                appendResponse('‚úÖ Switched to simulation mode to avoid quota limits', false);
            });

            // Clear response
            clearBtn.addEventListener('click', () => {
                responseDiv.innerHTML = '<div class="text-gray-400 text-sm italic">‚ú® Welcome! You\'re in simulation mode. The free tier quota (429 errors) will be simulated so you can see how to handle them.</div>';
            });

            function appendResponse(text, isUser = false, isError = false, extraClass = '') {
                const msgDiv = document.createElement('div');
                msgDiv.className = `mb-4 ${isUser ? 'text-right' : ''}`;
                
                let bgColor = isError ? 'bg-red-950/30 border-red-800' : (isUser ? 'bg-[#30353b]' : 'bg-[#25282c]');
                let icon = isUser ? 'üßë' : (isError ? '‚ö†Ô∏è' : 'ü§ñ');
                
                msgDiv.innerHTML = `<div class="${bgColor} border ${isError ? 'border-red-800' : 'border-[#41474e]'} rounded-lg p-3 text-sm inline-block max-w-[90%] whitespace-pre-wrap">${icon} ${text}</div>`;
                
                responseDiv.appendChild(msgDiv);
                responseDiv.scrollTop = responseDiv.scrollHeight;
            }

            // Simulate quota error
            function simulateQuotaError() {
                const errorMsg = `You exceeded your current quota, please check your plan and billing details.
* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_input_token_count, limit: 0, model: ${modelSelect.value}
* Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests, limit: 0, model: ${modelSelect.value}
Please retry in ${(Math.random() * 60 + 10).toFixed(2)}s.`;

                quotaMessage.textContent = errorMsg;
                quotaWarning.classList.remove('hidden');
                
                // Start countdown
                let seconds = 57;
                if (quotaResetTimer) clearInterval(quotaResetTimer);
                quotaResetTimer = setInterval(() => {
                    if (seconds <= 0) {
                        clearInterval(quotaResetTimer);
                        retryTimer.textContent = 'Quota should reset now. Try again?';
                    } else {
                        retryTimer.textContent = `‚è≥ Retry available in ${seconds--}s`;
                    }
                }, 1000);

                return `‚ùå 429 Quota Error (simulated):\n${errorMsg}`;
            }

            // Update request counter
            function updateRequestCounter() {
                const now = Date.now();
                if (now - lastRequestTime > 60000) { // Reset after 1 minute
                    requestCount = 0;
                }
                requestCount++;
                lastRequestTime = now;
                
                const rpm = parseInt(modelSelect.selectedOptions[0].dataset.rpm || '15');
                const percentage = Math.min(100, (requestCount / rpm) * 100);
                requestCounter.textContent = `${requestCount} / ${rpm} RPM`;
                usageBar.style.width = percentage + '%';
            }

            // Main send function
            sendBtn.addEventListener('click', async () => {
                const prompt = promptInput.value.trim();
                if (!prompt && !imageUpload.files.length) {
                    alert('Please enter a prompt');
                    return;
                }

                updateRequestCounter();
                appendResponse(prompt, true);

                // Simulate quota error randomly if in simulation mode
                if (simulationMode) {
                    await new Promise(r => setTimeout(r, 800));
                    
                    // 70% chance of quota error in simulation to demonstrate
                    if (Math.random() < 0.7) {
                        const errorResponse = simulateQuotaError();
                        appendResponse(errorResponse, false, true);
                    } else {
                        // Successful response
                        const model = modelSelect.value;
                        const isImageGen = model.includes('imagen');
                        
                        if (isImageGen) {
                            appendResponse(`‚ú® [Imagen 3] Generated image based on: "${prompt}"\n(Image would appear here - this is a simulation)`, false, false);
                        } else {
                            const response = `Based on the rate limits data you provided:

For long, large-scale usage, here are the best options:

1Ô∏è‚É£ **Gemini 2.0 Pro/Flash (Unlimited TPM)** - Best for very long documents and conversations because token limits are unlimited. RPM is 15, RPD is 1.5K.

2Ô∏è‚É£ **Gemma 3 27B (30 RPM, 14.4K RPD)** - Best for high-frequency requests with moderate message sizes. Higher request throughput.

3Ô∏è‚É£ **For multimodal needs**: Use Gemini 2.0 Flash Vision for image analysis (15 RPM) and Imagen 3 for image generation (25 RPD).

‚ö†Ô∏è **Note**: Free tier quotas are very limited. For production large-scale usage, you'll need a paid tier.`;
                            
                            appendResponse(response, false);
                        }
                    }
                } else {
                    // Live API mode
                    if (!apiKey) {
                        appendResponse('Please save your API key first', false, true);
                        return;
                    }

                    try {
                        const model = modelSelect.value;
                        const parts = [{ text: prompt }];
                        
                        // Add image if present
                        if (imageUpload.files.length) {
                            const file = imageUpload.files[0];
                            const reader = new FileReader();
                            const base64 = await new Promise((res) => {
                                reader.onload = (e) => res(e.target.result.split(',')[1]);
                                reader.readAsDataURL(file);
                            });
                            
                            parts.push({
                                inlineData: {
                                    mimeType: file.type,
                                    data: base64
                                }
                            });
                        }

                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts }],
                                generationConfig: { temperature: 0.7, maxOutputTokens: 2048 }
                            })
                        });

                        if (!response.ok) {
                            const error = await response.json();
                            if (response.status === 429) {
                                // Show quota warning
                                quotaMessage.textContent = error.error?.message || 'Quota exceeded';
                                quotaWarning.classList.remove('hidden');
                            }
                            throw new Error(`${response.status}: ${error.error?.message || 'Unknown error'}`);
                        }

                        const data = await response.json();
                        const text = data.candidates?.[0]?.content?.parts?.map(p => p.text).join('\n') || 'No response';
                        appendResponse(text, false);
                        
                    } catch (err) {
                        appendResponse(`Error: ${err.message}`, false, true);
                    }
                }
            });

            // Initial display
            updateModeDisplay();
            modelSelect.dispatchEvent(new Event('change'));
        })();
    </script>
</body>
</html>
